<!DOCTYPE html><html lang="zh-cn"> <head><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" type="image/svg+xml" href="https://files.rogery.dev/me/icon-128.png"><meta name="generator" content="Astro v5.3.0"><!-- Canonical URL --><link rel="canonical" href="https://blog.rogery.dev/post/norec-dfs/"><!-- Webfonts --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200..900&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin="anonymous" referrerpolicy="no-referrer"><!-- Primary Meta Tags --><title>Roger Young | 满二叉树的非递归 DFS 序遍历</title><meta name="title" content="Roger Young | 满二叉树的非递归 DFS 序遍历"><meta name="description" content="神奇的位运算"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://blog.rogery.dev/post/norec-dfs/"><meta property="og:title" content="满二叉树的非递归 DFS 序遍历"><meta property="og:description" content="神奇的位运算"><meta property="og:image" content="https://files.rogery.dev/me/icon-128.png"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://blog.rogery.dev/post/norec-dfs/"><meta property="twitter:title" content="满二叉树的非递归 DFS 序遍历"><meta property="twitter:description" content="神奇的位运算"><meta property="twitter:image" content="https://files.rogery.dev/me/icon-128.png"><link rel="stylesheet" href="/_astro/about.BglweZQ0.css">
<style>.article{max-width:48rem;p{margin-top:1.5rem;margin-bottom:1.5rem;text-align:justify;font-size:1rem}a,a:visited{overflow-wrap:anywhere;--un-text-opacity:1;color:rgb(168 0 0 / var(--un-text-opacity));text-decoration:none}a:hover{text-decoration-line:underline}h1,h2,h3,h4{font-weight:700}h1{margin-top:2rem;margin-bottom:2rem;font-size:2rem}h2{margin-top:1.75rem;margin-bottom:1.75rem;font-size:1.75rem}h3{margin-top:1.5rem;margin-bottom:1.5rem;font-size:1.5rem}h4{margin-top:1.5rem;margin-bottom:1.5rem;font-size:1.25rem}h5{margin-top:1.5rem;margin-bottom:1.5rem;font-size:1rem}.katex-display{overflow-x:auto;overflow-y:hidden}img{display:block;max-width:100%;height:auto}ol,ul{list-style-type:disc;padding-left:2rem}input,button,textarea,select{font-family:inherit}textarea{width:100%}code,pre,kbd{font-family:Maple Mono,Jetbrains Mono}table{margin-left:auto;margin-right:auto;width:auto;border-collapse:collapse;overflow-x:scroll;counter-increment:caption}img{width:100%;height:auto}table>thead{border-top-width:2.27px;border-bottom-width:1.8px;--un-border-opacity:1;border-color:rgb(0 0 0 / var(--un-border-opacity));border-style:solid;border-left-style:none;border-right-style:none}table>tbody{border-bottom-width:2.27px;--un-border-opacity:1;border-color:rgb(0 0 0 / var(--un-border-opacity));border-style:solid;border-left-style:none;border-right-style:none;border-top-style:none}th,td{padding:.25rem 1rem}caption{text-align:left;font-size:.923em;padding:0 .25em .25em;width:100%;margin-left:0}caption:before{content:"Table " counter(caption) ". ";font-weight:700}blockquote{margin-left:0;margin-right:0;margin-top:1.5rem;margin-bottom:1.5rem;padding:.25rem 1.25rem;background-color:#eee;border-inline-start:5px solid #000}.scroll-wrapper{overflow-x:auto}.scroll-wrapper>table td{white-space:nowrap}nav ol{counter-reset:item}nav li{display:block}nav li:before{content:counters(item,".") " ";counter-increment:item;padding-right:.85rem;font-weight:inherit;color:var(--link-visited)}dl dd{text-align:center}pre{margin-top:1rem;margin-bottom:1rem;border-width:2px;--un-border-opacity:1;border-color:rgb(0 0 0 / var(--un-border-opacity));border-style:solid;padding:1rem}code{font-size:.875rem}}
a[data-astro-cid-eimmu3lg]{display:inline-block;text-decoration:none}a[data-astro-cid-eimmu3lg].active{font-weight:bolder;text-decoration:underline}html,body{margin:0;padding:0;height:100%;scroll-behavior:smooth;line-height:1.5}a{color:inherit;text-decoration:inherit}button{background:none;border:none}ol,ul,menu{list-style:none;margin:0;padding:0}:where(html){line-height:1.15;-webkit-text-size-adjust:100%;text-size-adjust:100%}:where(h1){font-size:2em;margin-block-end:.67em;margin-block-start:.67em}:where(dl,ol,ul) :where(dl,ol,ul){margin-block-end:0;margin-block-start:0}:where(hr){box-sizing:content-box;color:inherit;height:0}:where(abbr[title]){text-decoration:underline;text-decoration:underline dotted}:where(b,strong){font-weight:bolder}:where(code,kbd,pre,samp){font-family:monospace,monospace;font-size:1em}:where(small){font-size:80%}:where(table){border-color:currentColor;text-indent:0}:where(button,input,select){margin:0}:where(button){text-transform:none}:where(button,input:is([type=button i],[type=reset i],[type=submit i])){-webkit-appearance:button}:where(progress){vertical-align:baseline}:where(select){text-transform:none}:where(textarea){margin:0}:where(input[type=search i]){-webkit-appearance:textfield;outline-offset:-2px}::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}:where(button,input:is([type=button i],[type=color i],[type=reset i],[type=submit i]))::-moz-focus-inner{border-style:none;padding:0}:where(button,input:is([type=button i],[type=color i],[type=reset i],[type=submit i]))::-moz-focusring{outline:1px dotted ButtonText}:where(:-moz-ui-invalid){box-shadow:none}:where(dialog){background-color:#fff;border:solid;color:#000;height:-moz-fit-content;height:fit-content;left:0;margin:auto;padding:1em;position:absolute;right:0;width:-moz-fit-content;width:fit-content}:where(dialog:not([open])){display:none}:where(summary){display:list-item}@font-face{font-family:Maple Mono;font-style:normal;font-weight:400;src:local("Maple Mono"),url(https://fastly.jsdelivr.net/gh/subframe7536/maple-font/woff2/MapleMono-Regular.woff2),}
</style></head> <body class="flex flex-col font-serif dark:bg-base line-height-normal"> <header class="shadow print:hidden"> <nav class="max-w-6xl mx-auto"> <div class="flex items-center justify-between "> <div class="pl-2 flex items-center space-x-4"> <img src="https://files.rogery.dev/me/icon-128.png" alt="Roger's avatar" class="w-12 h-12 rounded-full border-solid border-2 border-stone-300 transition transition-duration-500 hover:transform-rotate-720"> <a class="decoration-none color-base color-initial font-bold" href="/">Roger Young</a> </div> <div class="sm:hidden"> <button class="p-4 text-6 justify-center hover:bg-stone-200 inline-flex items-center "> <span class="i-ph-list">xx</span> </button> </div> <nav class="hidden sm:block"> <ul> <a href="/" class="p-5 font-medium  hover:bg-stone-200 hover:transition decoration-none color-initial" data-astro-cid-eimmu3lg> Home </a>  <a href="/post" class="p-5 font-medium  hover:bg-stone-200 hover:transition decoration-none color-initial" data-astro-cid-eimmu3lg> Articles </a>  <a href="/about" class="p-5 font-medium  hover:bg-stone-200 hover:transition decoration-none color-initial" data-astro-cid-eimmu3lg> About </a>  </ul> </nav> </div> </nav> </header> <main class="flex-1 px-4">  <article class="py-20"> <div class="article mx-auto">  <div class="text-center pt-10 pb-20"> <h1>满二叉树的非递归 DFS 序遍历</h1> <time datetime="2024-01-12T00:00:00.000Z"> 2024 年 1 月 12 日 </time> </div>  <p><a href="https://oi-wiki.org/misc/cdq-divide/">CDQ 分治</a> 是一种分治合并贡献的思想，主要是在递归树上遍历。半在线卷积算法其中就有 CDQ 分治的思想，而且其递归树是满二叉树。</p>
<p>很久以前造半在线卷积的时候，为了让分治与数据流解偶，想办法用位运算 <a href="https://www.luogu.com.cn/blog/rogeryoungh/ban-zai-xian-juan-ji-di-shi-xian">改造成 next 形式</a>。<a href="https://blog.asukakyle.top/">@HolyK</a> 似乎更早的注意到这一点（原博客好像消失了），并总结出相当一部分的 CDQ 都可以应用这种技巧。</p>
<p>考研学到二叉树时又捡起这个想法，半在线卷积只是中序遍历，其他序能不能也这样做呢？</p>
<p>本文主要总结了满二叉树的非递归实现，即需要保证 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span> 具有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mi>k</mi></msup></mrow><annotation encoding="application/x-tex">2^k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8491em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span></span></span></span></span></span></span></span></span></span></span> 的形式。</p>
<h2 id="bfs-序">BFS 序</h2>
<p>BFS 序即层序遍历，大家应该比较熟悉了。FFT 的迭代版一般用这个。</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49">void</span><span style="color:#6F42C1"> levelorder1</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#E36209"> n</span><span style="color:#24292E">) {</span><span style="color:#6A737D"> // 自底向上</span></span>
<span class="line"><span style="color:#D73A49">  for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">int</span><span style="color:#24292E"> l </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">; l </span><span style="color:#D73A49">&#x3C;=</span><span style="color:#24292E"> n; l </span><span style="color:#D73A49">*=</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">    for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">int</span><span style="color:#24292E"> i </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; i </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> n; i </span><span style="color:#D73A49">+=</span><span style="color:#24292E"> l) {</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\t\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i, i </span><span style="color:#D73A49">+</span><span style="color:#24292E"> l);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">void</span><span style="color:#6F42C1"> levelorder2</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#E36209"> n</span><span style="color:#24292E">) {</span><span style="color:#6A737D"> // 自顶向下</span></span>
<span class="line"><span style="color:#D73A49">  for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">int</span><span style="color:#24292E"> l </span><span style="color:#D73A49">=</span><span style="color:#24292E"> n; l </span><span style="color:#D73A49">>=</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">; l </span><span style="color:#D73A49">/=</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">    for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">int</span><span style="color:#24292E"> i </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; i </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> n; i </span><span style="color:#D73A49">+=</span><span style="color:#24292E"> l) {</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\t\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i, i </span><span style="color:#D73A49">+</span><span style="color:#24292E"> l);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h2 id="dfs-序">DFS 序</h2>
<p>DFS 序有三种：</p>
<ul>
<li>先序遍历：根左右</li>
<li>中序遍历：左根右</li>
<li>后序遍历：左右根</li>
</ul>
<h3 id="先序遍历">先序遍历</h3>
<p>注意到当前点的 lowbit 指示了其作为左边界的最大覆盖区间。</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49">void</span><span style="color:#6F42C1"> preorder</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#E36209"> n</span><span style="color:#24292E">) {</span><span style="color:#6A737D"> // 根左右</span></span>
<span class="line"><span style="color:#D73A49">  for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">int</span><span style="color:#24292E"> i </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; i </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> n; </span><span style="color:#D73A49">++</span><span style="color:#24292E">i) {</span></span>
<span class="line"><span style="color:#D73A49">    int</span><span style="color:#24292E"> u </span><span style="color:#D73A49">=</span><span style="color:#24292E"> i </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> 0</span><span style="color:#D73A49"> ?</span><span style="color:#24292E"> n </span><span style="color:#D73A49">:</span><span style="color:#24292E"> (i </span><span style="color:#D73A49">&#x26;</span><span style="color:#D73A49"> -</span><span style="color:#24292E">i);</span></span>
<span class="line"><span style="color:#D73A49">    for</span><span style="color:#24292E"> (; u </span><span style="color:#D73A49">></span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; u </span><span style="color:#D73A49">/=</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i, i </span><span style="color:#D73A49">+</span><span style="color:#24292E"> u);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h3 id="中序遍历">中序遍历</h3>
<p>注意到当前点的 lowbit 指示了其左右范围。</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49">void</span><span style="color:#6F42C1"> inorder</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#E36209"> n</span><span style="color:#24292E">) {</span><span style="color:#6A737D"> // 左根右</span></span>
<span class="line"><span style="color:#D73A49">  for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">int</span><span style="color:#24292E"> i </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">; i </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> n; </span><span style="color:#D73A49">++</span><span style="color:#24292E">i) {</span></span>
<span class="line"><span style="color:#D73A49">    int</span><span style="color:#24292E"> u </span><span style="color:#D73A49">=</span><span style="color:#24292E"> i </span><span style="color:#D73A49">&#x26;</span><span style="color:#D73A49"> -</span><span style="color:#24292E">i;</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> (u </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i </span><span style="color:#D73A49">-</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">, i);</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i </span><span style="color:#D73A49">-</span><span style="color:#24292E"> u, i </span><span style="color:#D73A49">+</span><span style="color:#24292E"> u);</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i, i </span><span style="color:#D73A49">+</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i </span><span style="color:#D73A49">-</span><span style="color:#24292E"> u, i </span><span style="color:#D73A49">+</span><span style="color:#24292E"> u);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h3 id="后序遍历">后序遍历</h3>
<p>后序遍历直接测试即可。</p>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49">void</span><span style="color:#6F42C1"> postorder</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#E36209"> n</span><span style="color:#24292E">) {</span><span style="color:#6A737D"> // 左右根</span></span>
<span class="line"><span style="color:#D73A49">  for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">int</span><span style="color:#24292E"> i </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">; i </span><span style="color:#D73A49">&#x3C;=</span><span style="color:#24292E"> n; </span><span style="color:#D73A49">++</span><span style="color:#24292E">i) {</span></span>
<span class="line"><span style="color:#D73A49">    int</span><span style="color:#24292E"> u </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">    while</span><span style="color:#24292E"> (</span><span style="color:#005CC5">true</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i </span><span style="color:#D73A49">-</span><span style="color:#24292E"> u, i);</span></span>
<span class="line"><span style="color:#D73A49">      if</span><span style="color:#24292E"> (u </span><span style="color:#D73A49">&#x26;</span><span style="color:#24292E"> i)</span></span>
<span class="line"><span style="color:#D73A49">        break</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">      u </span><span style="color:#D73A49">*=</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h2 id="最低步长">最低步长</h2>
<p>有时候我们需要做类似循环展开的优化，加入了最低步长的控制。</p>
<h3 id="先序遍历step">先序遍历（step）</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49">void</span><span style="color:#6F42C1"> preorder</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#E36209"> n</span><span style="color:#24292E">, </span><span style="color:#D73A49">int</span><span style="color:#E36209"> step</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">) {</span><span style="color:#6A737D"> // 根左右</span></span>
<span class="line"><span style="color:#D73A49">  for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">int</span><span style="color:#24292E"> i </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">; i </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> n; i </span><span style="color:#D73A49">+=</span><span style="color:#24292E"> step) {</span></span>
<span class="line"><span style="color:#D73A49">    int</span><span style="color:#24292E"> u </span><span style="color:#D73A49">=</span><span style="color:#24292E"> i </span><span style="color:#D73A49">==</span><span style="color:#005CC5"> 0</span><span style="color:#D73A49"> ?</span><span style="color:#24292E"> n </span><span style="color:#D73A49">:</span><span style="color:#24292E"> (i </span><span style="color:#D73A49">&#x26;</span><span style="color:#D73A49"> -</span><span style="color:#24292E">i);</span></span>
<span class="line"><span style="color:#D73A49">    for</span><span style="color:#24292E"> (; u </span><span style="color:#D73A49">>=</span><span style="color:#24292E"> step; u </span><span style="color:#D73A49">/=</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i, i </span><span style="color:#D73A49">+</span><span style="color:#24292E"> u);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h3 id="中序遍历step">中序遍历（step）</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49">void</span><span style="color:#6F42C1"> inorder</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#E36209"> n</span><span style="color:#24292E">, </span><span style="color:#D73A49">int</span><span style="color:#E36209"> step</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">) {</span><span style="color:#6A737D"> // 左根右</span></span>
<span class="line"><span style="color:#D73A49">  for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">int</span><span style="color:#24292E"> i </span><span style="color:#D73A49">=</span><span style="color:#24292E"> step; i </span><span style="color:#D73A49">&#x3C;</span><span style="color:#24292E"> n; i </span><span style="color:#D73A49">+=</span><span style="color:#24292E"> step) {</span></span>
<span class="line"><span style="color:#D73A49">    int</span><span style="color:#24292E"> l </span><span style="color:#D73A49">=</span><span style="color:#24292E"> i </span><span style="color:#D73A49">&#x26;</span><span style="color:#D73A49"> -</span><span style="color:#24292E">i;</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> (l </span><span style="color:#D73A49">==</span><span style="color:#24292E"> step) {</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i </span><span style="color:#D73A49">-</span><span style="color:#24292E"> step, i);</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i </span><span style="color:#D73A49">-</span><span style="color:#24292E"> l, i </span><span style="color:#D73A49">+</span><span style="color:#24292E"> l);</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i, i </span><span style="color:#D73A49">+</span><span style="color:#24292E"> step);</span></span>
<span class="line"><span style="color:#24292E">    } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i </span><span style="color:#D73A49">-</span><span style="color:#24292E"> l, i </span><span style="color:#D73A49">+</span><span style="color:#24292E"> l);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h3 id="后序遍历step">后序遍历（step）</h3>
<pre class="astro-code github-light" style="background-color:#fff;color:#24292e; overflow-x: auto;" tabindex="0" data-language="cpp"><code><span class="line"><span style="color:#D73A49">void</span><span style="color:#6F42C1"> postorder</span><span style="color:#24292E">(</span><span style="color:#D73A49">int</span><span style="color:#E36209"> n</span><span style="color:#24292E">, </span><span style="color:#D73A49">int</span><span style="color:#E36209"> step</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">) {</span><span style="color:#6A737D"> // 左右根</span></span>
<span class="line"><span style="color:#D73A49">  for</span><span style="color:#24292E"> (</span><span style="color:#D73A49">int</span><span style="color:#24292E"> i </span><span style="color:#D73A49">=</span><span style="color:#24292E"> step; i </span><span style="color:#D73A49">&#x3C;=</span><span style="color:#24292E"> n; i </span><span style="color:#D73A49">+=</span><span style="color:#24292E"> step) {</span></span>
<span class="line"><span style="color:#D73A49">    int</span><span style="color:#24292E"> l </span><span style="color:#D73A49">=</span><span style="color:#24292E"> step;</span></span>
<span class="line"><span style="color:#D73A49">    while</span><span style="color:#24292E"> (</span><span style="color:#005CC5">true</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6F42C1">      std</span><span style="color:#24292E">::</span><span style="color:#6F42C1">printf</span><span style="color:#24292E">(</span><span style="color:#032F62">"[</span><span style="color:#005CC5">%d</span><span style="color:#032F62">, </span><span style="color:#005CC5">%d</span><span style="color:#032F62">)</span><span style="color:#005CC5">\n</span><span style="color:#032F62">"</span><span style="color:#24292E">, i </span><span style="color:#D73A49">-</span><span style="color:#24292E"> l, i);</span></span>
<span class="line"><span style="color:#D73A49">      if</span><span style="color:#24292E"> (l </span><span style="color:#D73A49">&#x26;</span><span style="color:#24292E"> i)</span></span>
<span class="line"><span style="color:#D73A49">        break</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">      l </span><span style="color:#D73A49">*=</span><span style="color:#005CC5"> 2</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre>
<h2 id="后记">后记</h2>
<p>不知道能不能整出来非迭代的 DFS 序 FFT。</p>  <section class="mx-auto mt-12"> <script src="https://giscus.app/client.js" data-repo="rogeryoungh/blog" data-repo-id="MDEwOlJlcG9zaXRvcnkzODQyNDIyNTQ=" data-category="Giscus" data-category-id="DIC_kwDOFucSTs4CTTLS" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="light" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async></script> </section>  </div> </article>  </main> <footer class="bg-stone-100 "> <div class="px-4 py-8"> <p class="flex items-center text-3 justify-center text-secondary"> <span>© 2025 Roger Young</span> <span class="i-ph-lightning px-1"></span> <span>Powered by
<a href="https://astro.build/">Astro</a> </span> </p> </div> </footer> </body></html>